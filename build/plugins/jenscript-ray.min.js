// JenScript -  JavaScript HTML5/SVG Library
// version : 1.2.0
// Author : Sebastien Janaud 
// Web Site : http://jenscript.io
// Twitter  : http://twitter.com/JenSoftAPI
// Copyright (C) 2008 - 2017 JenScript, product by JenSoftAPI company, France.
// build: 2017-05-23
// All Rights reserved

!function(){JenScript.RayPainter=function(a){this.init(a)},JenScript.Model.addMethods(JenScript.RayPainter,{init:function(a){a=a||{}},paintRay:function(){}})}(),function(){JenScript.RayFill=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.RayFill,JenScript.RayPainter),JenScript.Model.addMethods(JenScript.RayFill,{_init:function(a){a=a||{},this.Id="rayfill"+JenScript.sequenceId++,JenScript.RayPainter.call(this,a)},paintRayFill:function(){},paintRay:function(a,b){this.paintRayFill(a,b)}}),JenScript.RayFill0=function(a){this.__init(a)},JenScript.Model.inheritPrototype(JenScript.RayFill0,JenScript.RayFill),JenScript.Model.addMethods(JenScript.RayFill0,{__init:function(a){a=a||{},JenScript.RayFill.call(this,a)},paintRayFill:function(a,b){a.deleteGraphicsElement(this.Id+b.Id);var c=b.getRayShape().Id(this.Id+b.Id).fill(b.themeColor).fillOpacity(b.opacity).toSVG();a.insertSVG(c);var d=c.getBBox();b.setBound2D(new JenScript.Bound2D(d.x,d.y,d.width,d.height))}})}(),function(){JenScript.Ray=function(a){a=a||{},this.name=void 0!==a.name?a.name:"ray name undefined",this.Id=void 0!==a.Id?a.Id:"ray"+JenScript.sequenceId++,this.themeColor=void 0!==a.themeColor?a.themeColor:"blue",this.opacity=void 0!==a.opacity?a.opacity:1,this.thickness,this.thicknessType,this.ray,this.rayBase,this.rayValue,this.ascent=!1,this.descent=!1,this.rayNature,this.rayShape,this.rayDraw,this.rayFill=new JenScript.RayFill0,this.rayEffect,this.rayLabel,this.rayAxisLabel,this.plugin,this.lockEnter=!1,this.inflating=!1,this.deflating=!1,this.bound2D,this.parent},JenScript.Model.addMethods(JenScript.Ray,{getBound2D:function(){return this.bound2D},setBound2D:function(a){this.bound2D=a},getRayDraw:function(){return this.rayDraw},setRayDraw:function(a){this.rayDraw=a},getRayFill:function(){return this.rayFill},setRayFill:function(a){this.rayFill=a},getRayEffect:function(){return this.rayEffect},setRayEffect:function(a){this.rayEffect=a},getRayLabel:function(){return this.rayLabel},setRayLabel:function(a){this.rayLabel=a},getRayAxisLabel:function(){return this.rayAxisLabel},setRayAxisLabel:function(a){this.rayAxisLabel=a},getName:function(){return this.name},setName:function(a){this.name=a},getThemeColor:function(){return this.themeColor},setThemeColor:function(a){this.themeColor=a},getThickness:function(){return this.thickness},setThickness:function(a){this.thickness=a},getThicknessType:function(){return this.thicknessType},setThicknessType:function(a){this.thicknessType=a},getRayNature:function(){return this.rayNature},setRayNature:function(a){this.rayNature=a},getRay:function(){return this.ray},setRay:function(a){this.ray=a},getRayValue:function(){return this.rayValue},setAscentValue:function(a){if(this.ascent=!0,this.descent=!1,0>a)throw new Error("ray value should be greater than 0");this.rayValue=a},setDescentValue:function(a){if(this.ascent=!1,this.descent=!0,0>a)throw new Error("ray value should be greater than 0");this.rayValue=a},getRayBase:function(){return this.rayBase},setRayBase:function(a){this.rayBase=a},isAscent:function(){return this.ascent},isDescent:function(){return this.descent},getRayShape:function(){return this.rayShape},setRayShape:function(a){this.rayShape=a},getPlugin:function(){return this.plugin},setPlugin:function(a){this.plugin=a},isLockEnter:function(){return this.lockEnter},setLockEnter:function(a){this.lockEnter=a},isInflating:function(){return this.inflating},setInflating:function(a){this.inflating=a},isDeflating:function(){return this.deflating},setDeflating:function(a){this.deflating=a},setLockEnter:function(a){this.lockEnter=a}}),JenScript.StackedRay=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.StackedRay,JenScript.Ray),JenScript.Model.addMethods(JenScript.StackedRay,{_init:function(a){this.stacks=[],JenScript.Ray.call(this,a)},getStackBase:function(a){for(var b=this.getRayBase(),c=0;c<this.stacks.length;c++){var d=this.stacks[c];if(a.equals(d))return b;this.isAscent()?b+=d.getNormalizedValue():this.isDescent()&&(b-=d.getNormalizedValue())}return b},addStack:function(a){if(a.getStackValue()<0)throw new Error("stack value value should be greater than 0");a.parent=this,this.stacks.push(a)},normalize:function(){for(var a=Math.abs(this.getRayValue()),b=0,c=0;c<this.stacks.length;c++)b+=this.stacks[c].getStackValue();for(var c=0;c<this.stacks.length;c++)this.stacks[c].setNormalizedValue(this.stacks[c].getStackValue()*a/b)},getStacks:function(){return this.stacks},setStacks:function(a){this.stacks=a}}),JenScript.RayStack=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.RayStack,JenScript.Ray),JenScript.Model.addMethods(JenScript.RayStack,{_init:function(a){a=a||{},this.stackValue=void 0!==a.stackValue?a.stackValue:1,this.normalizedValue,this.ray,JenScript.Ray.call(this,a)},equals:function(a){return a.Id===this.Id},toString:function(){return"Ray Stack [name="+this.name+", Id="+this.Id+", stackValue="+this.stackValue+", normalizedValue="+this.normalizedValue+"]"},getStackValue:function(){return this.stackValue},setStackValue:function(a){this.stackValue=a},getNormalizedValue:function(){return this.normalizedValue},setNormalizedValue:function(a){this.normalizedValue=a},getRay:function(){return this.ray},setRay:function(a){this.ray=a}})}(),function(){JenScript.RayPlugin=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.RayPlugin,JenScript.Plugin),JenScript.Model.addMethods(JenScript.RayPlugin,{_init:function(a){a=a||{},this.rays=[],this.raysListeners=[],a.name="RayPlugin",JenScript.Plugin.call(this,a)},onProjectionRegister:function(){var a=this;this.getProjection().addProjectionListener("boundChanged",function(){a.repaintPlugin()},a.toString())},addRay:function(a){a.plugin=this,this.rays.push(a)},toString:function(){return"JenScript.RayPlugin"},addRayListener:function(a,b,c){if(void 0===c)throw new Error("Ray listener, listener name should be supplied.");var d={action:a,onEvent:b,name:c};this.raysListeners[this.raysListeners.length]=d},fireRayEvent:function(a,b){for(var c=0;c<this.raysListeners.length;c++){var d=this.raysListeners[c];a===d.action&&d.onEvent(b)}},checkRay:function(a){if(void 0===a.getRayNature())throw new Error("Ray nature should be supplied")},resolveRayPluginGeometry:function(){var a=this,b=function(b){a.checkRay(b),b instanceof JenScript.StackedRay?a.resolveStackedRayGeometry(b):a.resolveRayGeometry(b)};this.rays.forEach(b)},resolveRayComponent:function(a){a instanceof JenScript.StackedRay?this.resolveStackedRayGeometry(a):this.resolveRayGeometry(a)},resolveRayGeometry:function(a){var b=this.getProjection();if("XRay"===a.getRayNature()){var c=a.getRay(),d=b.userToPixel(new JenScript.Point2D(c,0)).getX(),e=0;if("Device"===a.getThicknessType())e=a.getThickness();else{var f=c-a.getThickness()/2,g=b.userToPixel(new JenScript.Point2D(f,0)),h=c+a.getThickness()/2,i=b.userToPixel(new JenScript.Point2D(h,0));e=i.getX()-g.getX()}var j=0;a.isAscent()&&(j=a.getRayBase()),a.isDescent()&&(j=a.getRayBase()-a.getRayValue());var k=b.userToPixel(new JenScript.Point2D(0,j)).getY(),l=0;a.isAscent()&&(l=a.getRayBase()+a.getRayValue()),a.isDescent()&&(l=a.getRayBase());var m=b.userToPixel(new JenScript.Point2D(0,l)).getY(),n=d-e/2,o=m,p=e,q=Math.abs(m-k),r=(new JenScript.SVGRect).origin(n,o).size(p,q);a.setRayShape(r)}else if("YRay"===a.getRayNature()){var s=a.getRay(),t=b.userToPixel(new JenScript.Point2D(0,s)).getY(),u=0;if("Device"==a.getThicknessType())u=a.getThickness();else{var v=s-a.getThickness()/2,w=b.userToPixel(new JenScript.Point2D(0,v)),x=s+a.getThickness()/2,y=b.userToPixel(new JenScript.Point2D(0,x));u=Math.abs(w.getY()-y.getY())}var z=0;a.isAscent()&&(z=a.getRayBase()),a.isDescent()&&(z=a.getRayBase()-a.getRayValue());var A=b.userToPixel(new JenScript.Point2D(z,0)).getX(),B=0;a.isAscent()&&(B=a.getRayBase()-a.getRayValue()),a.isDescent()&&(B=a.getRayBase());var C=b.userToPixel(new JenScript.Point2D(B,0)).getX(),n=A,o=t-u/2,p=Math.abs(C-A),q=u,r=(new JenScript.SVGRect).origin(n,o).size(p,q);a.setRayShape(r)}},resolveStackedRayGeometry:function(a){var b=this.getProjection();if(a.normalize(),"XRay"===a.getRayNature()){var c=a.getRay(),d=b.userToPixel(new JenScript.Point2D(c,0)).getX(),e=0;if("Device"==a.getThicknessType())e=a.getThickness();else{var f=c-a.getThickness()/2,g=b.userToPixel(new JenScript.Point2D(f,0)),h=c+a.getThickness()/2,i=b.userToPixel(new JenScript.Point2D(h,0));e=i.getX()-g.getX()}var j=0;a.isAscent()&&(j=a.getRayBase()),a.isDescent()&&(j=a.getRayBase()-a.getRayValue());var k=b.userToPixel(new JenScript.Point2D(0,j)).getY(),l=0;a.isAscent()&&(l=a.getRayBase()+a.getRayValue()),a.isDescent()&&(l=a.getRayBase());var m=b.userToPixel(new JenScript.Point2D(0,l)).getY(),n=d-e/2,o=m,p=e,q=Math.abs(m-k),r=(new JenScript.SVGRect).origin(n,o).size(p,q);a.setRayShape(r);for(var s=0;s<a.getStacks().length;s++){var t=a.getStacks()[s];t.setRayNature(a.getRayNature()),t.setThickness(a.getThickness()),t.setThicknessType(a.getThicknessType()),t.setRay(a.getRay()),t.setRayBase(a.getStackBase(t)),t.setThemeColor(t.getThemeColor()),t.setRayFill(t.getRayFill()),t.setRayDraw(t.getRayDraw()),t.setRayEffect(t.getRayEffect()),t.isAscent()?t.setAscentValue(t.getNormalizedValue()):a.isDescent()&&t.setDescentValue(t.getNormalizedValue());var u=0;a.isAscent()&&(u=a.getStackBase(t)),a.isDescent()&&(u=a.getStackBase(t)-t.getNormalizedValue());var v=b.userToPixel(new JenScript.Point2D(0,u)).getY(),w=0;a.isAscent()&&(w=a.getStackBase(t)+t.getNormalizedValue()),a.isDescent()&&(w=a.getStackBase(t));var x=b.userToPixel(new JenScript.Point2D(0,w)).getY(),y=d-e/2,z=x,A=e,B=Math.abs(x-v),C=(new JenScript.SVGRect).origin(y,z).size(A,B);t.setRayShape(C)}}else if("YRay"===a.getRayNature()){var D=a.getRay(),E=b.userToPixel(new JenScript.Point2D(0,D)).getY(),F=0;if("Device"==a.getThicknessType())F=a.getThickness();else{var G=D-a.getThickness()/2,H=b.userToPixel(new JenScript.Point2D(0,G)),I=D+a.getThickness()/2,J=b.userToPixel(new JenScript.Point2D(0,I));F=Math.abs(H.getY()-J.getY())}var K=0;a.isAscent()&&(K=a.getRayBase()),a.isDescent()&&(K=a.getRayBase()-a.getRayValue());var L=b.userToPixel(new JenScript.Point2D(K,0)).getX(),M=0;a.isAscent()&&(M=a.getRayBase()-a.getRayValue()),a.isDescent()&&(M=a.getRayBase());var N=b.userToPixel(new JenScript.Point2D(M,0)).getX(),n=L,o=E-F/2,p=Math.abs(N-L),q=F,r=(new JenScript.SVGRect).origin(n,o).size(p,q);a.setRayShape(r);for(var s=0;s<a.getStacks().length;s++){var t=a.getStacks()[s];t.setRayNature(a.getRayNature()),t.setThickness(a.getThickness()),t.setThicknessType(a.getThicknessType()),t.setRay(a.getRay()),t.setRayBase(a.getStackBase(t)),t.setThemeColor(t.getThemeColor()),t.setRayFill(t.getRayFill()),t.setRayDraw(t.getRayDraw()),t.setRayEffect(t.getRayEffect()),a.isAscent()?t.setAscentValue(t.getNormalizedValue()):a.isDescent()&&t.setDescentValue(t.getNormalizedValue());var O=0;a.isAscent()&&(O=a.getStackBase(t)),a.isDescent()&&(O=a.getStackBase(t)-t.getNormalizedValue());var P=b.userToPixel(new JenScript.Point2D(O,0)).getX(),Q=0;a.isAscent()&&(Q=a.getStackBase(t)-t.getNormalizedValue()),a.isDescent()&&(Q=a.getStackBase(t));var R=b.userToPixel(new JenScript.Point2D(Q,0)).getX(),y=P,z=E-F/2,A=Math.abs(R-P),B=F,C=(new JenScript.SVGRect).origin(y,z).size(A,B);t.setRayShape(C)}}},paintRay:function(a,b,c,d){b.plugin=this,"RayLayer"===d?(void 0!==b.getRayFill()&&b.getRayFill().paintRay(a,b,c),void 0!==b.getRayEffect()&&b.getRayEffect().paintRay(a,b,c),void 0!==b.getRayDraw()&&b.getRayDraw().paintRay(a,b,c)):null!=b.getRayLabel()&&b.getRayLabel().paintRay(a,b,c)},paintStackedRay:function(a,b,c,d){for(var e=b.getStacks(),f=0;f<e.length;f++){var g=e[f];this.paintRay(a,g,c,d)}},paintPlugin:function(a,b){if(this.resolveRayPluginGeometry(),b===JenScript.ViewPart.Device){for(var c=0;c<this.rays.length;c++){var d=this.rays[c];d instanceof JenScript.StackedRay?this.paintStackedRay(a,d,b,"RayLayer"):this.paintRay(a,d,b,"RayLayer")}for(var c=0;c<this.rays.length;c++){var d=this.rays[c];d instanceof JenScript.StackedRay?this.paintStackedRay(a,d,b,"LabelLayer"):this.paintRay(a,d,b,"LabelLayer")}}},paintRayAxisLabel:function(){},onRelease:function(a,b,c,d){this.rayCheck("release",a,c,d)},onPress:function(a,b,c,d){this.rayCheck("press",a,c,d)},onMove:function(a,b,c,d){this.rayCheck("move",a,c,d)},rayCheck:function(a,b,c,d){for(var e=this,f=function(b){"press"===a?e.fireRayEvent("press",{ray:b,x:c,y:d,device:{x:c,y:d}}):"release"===a?e.fireRayEvent("release",{ray:b,x:c,y:d,device:{x:c,y:d}}):e.rayEnterExitTracker(b,c,d)},g=function(b){if(void 0!==b.getBound2D()){var e=void 0!==b.getBound2D()&&b.getBound2D().contains(c,d);"move"!==a&&e&&b.isLockEnter()?f(b):"move"===a&&f(b)}},h=0;h<this.rays.length;h++){var i=this.rays[h];if(i instanceof JenScript.StackedRay){var j=i;g(j);for(var k=j.getStacks(),l=0;l<k.length;l++){var m=k[l];g(m)}}else i instanceof JenScript.Ray&&g(i)}},rayEnterExitTracker:function(a,b,c){void 0!==a.getBound2D()&&(a.getBound2D().contains(b,c)&&!a.isLockEnter()&&(a.setLockEnter(!0),this.fireRayEvent("enter",{ray:a,x:b,y:c,device:{x:b,y:c}})),a.getBound2D().contains(b,c)&&a.isLockEnter()?this.fireRayEvent("move",{ray:a,x:b,y:c,device:{x:b,y:c}}):!a.getBound2D().contains(b,c)&&a.isLockEnter()&&(a.setLockEnter(!1),this.fireRayEvent("exit",{ray:a,x:b,y:c,device:{x:b,y:c}})))}})}();